cmake_minimum_required(VERSION 3.16)

set(ENCLAVE_NAME helloworld_enclave) # Can be different from EDL basename for target
set(ENCLAVE_SOURCES
    enc.c
    ${EDL_TRUSTED_C} # Generated by root CMake, available via include_directories
)
# helloworld_t.h will be included by enc.c

# The EDL configuration file for signing
set(ENCLAVE_CONF_FILE ${CMAKE_CURRENT_SOURCE_DIR}/helloworld.conf)

# Add enclave using Open Enclave's CMake function
# This function handles compilation, linking, and signing.
oe_add_enclave(${ENCLAVE_NAME}
    SOURCES ${ENCLAVE_SOURCES}
    CONFIG_FILE ${ENCLAVE_CONF_FILE}
    # KEY_FILE path/to/private.pem # Optional: specify signing key, otherwise one may be generated
)
# oe_add_enclave links oeenclave, oecryptombedtls (by default), oelibc, oesyscall, oecore
# as described in the helloworld README.

# Ensure EDL generation is a dependency
add_dependencies(${ENCLAVE_NAME} GenerateEDL)

message(STATUS "Configuring Enclave: ${ENCLAVE_NAME}")
message(STATUS "  Enclave sources: ${ENCLAVE_SOURCES}")
message(STATUS "  Enclave config: ${ENCLAVE_CONF_FILE}")